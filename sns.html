<!DOCTYPE html>
<html lang="ja">
<head><title>SNS 教室</title></head>
<body>
  <h2>ようこそ, <span id="user"></span></h2>
  <div>
    <input id="courseName" placeholder="新しいコース">
    <input id="coursePass" placeholder="パスワード">
    <button onclick="addCourse()">作成</button>
  </div>
  <ul id="courseList"></ul>
  <hr>
  <div id="forum"></div>
  <button id="teacherKey" onclick="location.href='https://classroom.google.com'" style="display:none;">先生キー</button>
  <script>
    const base = 'https://script.google.com/macros/s/AKfycbzOWtwafo0JpD8ysxJtdrwlvCrSBTuY86_3o8MMfLb-uNy5DCas8Tst3CxK1iFiVf3I/exec';
    document.getElementById('user').innerText = localStorage.getItem('name');
    if (localStorage.getItem('isAdmin') === 'true') {
      let clickCount = 0;
      document.title = "SNS 教室";
      document.body.onclick = () => {
        clickCount++;
        if (clickCount === 2) {
          const pass = prompt("バージョンを入力：");
          if (pass === 'Wlj20120917') location.href = 'admin.html';
        }
      };
    }
    document.getElementById('teacherKey').style.display = 'block';
    async function addCourse() {
      const res = await fetch(base, {
        method: 'POST',
        body: new URLSearchParams({
          action: 'addCourse',
          name: document.getElementById('courseName').value,
          password: document.getElementById('coursePass').value,
          email: localStorage.getItem('name')
        })
      });
      loadCourses();
    }
    async function loadCourses() {
      const res = await fetch(base + '?action=getCourses');
      const json = await res.json();
      const list = document.getElementById('courseList');
      list.innerHTML = '';
      json.forEach(course => {
        const li = document.createElement('li');
        li.innerText = course.name;
        list.appendChild(li);
      });
    }
    loadCourses();
  </script>
</body>
</html>
